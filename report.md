BÃO CÃO Tá»”NG Káº¾T Äá»€ TÃ€I

TÃªn Ä‘á» tÃ i: XÃ¢y dá»±ng bot Discord láº¥y Ã½ tÆ°á»Ÿng tá»« Dragon Ball vÃ  game Ngá»c Rá»“ng Online

1. CÆ¡ sá»Ÿ lÃ½ thuyáº¿t vÃ  kháº£o sÃ¡t
1.1. Giá»›i thiá»‡u Ä‘á» tÃ i

Hiá»‡n nay, Discord lÃ  má»™t ná»n táº£ng chat/voice Ä‘Æ°á»£c cá»™ng Ä‘á»“ng game thá»§ sá»­ dá»¥ng ráº¥t nhiá»u Ä‘á»ƒ giao lÆ°u, tá»• chá»©c hoáº¡t Ä‘á»™ng vÃ  xÃ¢y dá»±ng cá»™ng Ä‘á»“ng. Song song Ä‘Ã³, Dragon Ball vÃ  game Ngá»c Rá»“ng Online cÃ³ fanbase ráº¥t Ä‘Ã´ng Ä‘áº£o táº¡i Viá»‡t Nam, vá»›i cÃ¡c yáº¿u tá»‘ quen thuá»™c nhÆ° thu tháº­p ngá»c rá»“ng, luyá»‡n sá»©c máº¡nh, Ä‘i Ä‘Ã¡nh quÃ¡i, tham gia sá»± kiá»‡n, Ä‘áº¥u Boss,â€¦

Äá» tÃ i táº­p trung xÃ¢y dá»±ng má»™t bot Discord láº¥y Ã½ tÆ°á»Ÿng tá»« Dragon Ball vÃ  Ngá»c Rá»“ng Online. Bot cho phÃ©p ngÆ°á»i dÃ¹ng trong server Discord:

Táº¡o nhÃ¢n váº­t vá»›i phong cÃ¡ch Dragon Ball (Saiyan, Namek, Earthling, v.v.)

Thá»±c hiá»‡n cÃ¡c hoáº¡t Ä‘á»™ng nhÆ°: luyá»‡n táº­p, Ä‘i nhiá»‡m vá»¥, sÄƒn quÃ¡i, tham gia event, thu tháº­p ngá»c rá»“ng, triá»‡u há»“i Rá»“ng Tháº§n Ä‘á»ƒ nháº­n thÆ°á»Ÿng.

TÃ­ch lÅ©y sá»©c máº¡nh, tiá»n tá»‡ áº£o, trang bá»‹ vÃ  cáº¡nh tranh trÃªn báº£ng xáº¿p háº¡ng trong server.

Há»— trá»£ quáº£n trá»‹ viÃªn (admin/mod) cáº¥u hÃ¬nh sá»± kiá»‡n, pháº§n thÆ°á»Ÿng vÃ  luáº­t chÆ¡i trong server Discord cá»§a há».

Má»¥c tiÃªu cá»§a Ä‘á» tÃ i:

XÃ¢y dá»±ng má»™t bot Discord hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh, dá»… sá»­ dá»¥ng, thÃ¢n thiá»‡n vá»›i ngÆ°á»i dÃ¹ng.

Thiáº¿t káº¿ há»‡ thá»‘ng má»Ÿ rá»™ng Ä‘Æ°á»£c, cÃ³ thá»ƒ bá»• sung thÃªm skill, map, nhiá»‡m vá»¥ vÃ  sá»± kiá»‡n má»›i trong tÆ°Æ¡ng lai.

á»¨ng dá»¥ng cÃ¡c kiáº¿n thá»©c vá» ká»¹ nghá»‡ pháº§n má»m, mÃ´ hÃ¬nh phÃ¡t triá»ƒn, phÃ¢n tÃ­ch â€“ thiáº¿t káº¿ há»‡ thá»‘ng vÃ  kiá»ƒm thá»­ vÃ o má»™t dá»± Ã¡n thá»±c táº¿.

1.2. Kiáº¿n thá»©c ná»n vá» ká»¹ nghá»‡ vÃ  kiá»ƒm thá»­ pháº§n má»m

Äá»ƒ phÃ¡t triá»ƒn bot Discord má»™t cÃ¡ch bÃ i báº£n, Ä‘á» tÃ i Ã¡p dá»¥ng cÃ¡c kiáº¿n thá»©c ná»n táº£ng sau:

Ká»¹ nghá»‡ pháº§n má»m (Software Engineering):

Quy trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m (SDLC).

PhÃ¢n tÃ­ch yÃªu cáº§u, thiáº¿t káº¿, cÃ i Ä‘áº·t, kiá»ƒm thá»­ vÃ  báº£o trÃ¬.

NguyÃªn táº¯c thiáº¿t káº¿ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (OOP), phÃ¢n lá»›p theo trÃ¡ch nhiá»‡m (Separation of Concerns).

Quáº£n lÃ½ cáº¥u hÃ¬nh mÃ£ nguá»“n báº±ng Git.

Kiá»ƒm thá»­ pháº§n má»m (Software Testing):

CÃ¡c má»©c kiá»ƒm thá»­: Unit Test, Integration Test, System Test.

CÃ¡c ká»¹ thuáº­t thiáº¿t káº¿ ca kiá»ƒm thá»­: kiá»ƒm thá»­ há»™p Ä‘en (Black-box), kiá»ƒm thá»­ biÃªn (Boundary Value), kiá»ƒm thá»­ dá»±a trÃªn ca sá»­ dá»¥ng.

Ghi nháº­n lá»—i (Bug Report) vÃ  vÃ²ng Ä‘á»i lá»—i.

Viá»‡c Ã¡p dá»¥ng Ä‘Ãºng quy trÃ¬nh ká»¹ nghá»‡ vÃ  kiá»ƒm thá»­ giÃºp bot Discord hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh, háº¡n cháº¿ lá»—i khi triá»ƒn khai trong mÃ´i trÆ°á»ng thá»±c táº¿ (nhiá»u server, nhiá»u ngÆ°á»i dÃ¹ng truy cáº­p cÃ¹ng lÃºc).

1.3. CÃ¡c mÃ´ hÃ¬nh phÃ¡t triá»ƒn pháº§n má»m (chá»n mÃ´ hÃ¬nh Ã¡p dá»¥ng)

Má»™t sá»‘ mÃ´ hÃ¬nh phÃ¡t triá»ƒn pháº§n má»m phá»• biáº¿n:

MÃ´ hÃ¬nh thÃ¡c nÆ°á»›c (Waterfall).

MÃ´ hÃ¬nh xoáº¯n á»‘c (Spiral).

MÃ´ hÃ¬nh phÃ¡t triá»ƒn láº·p vÃ  tÄƒng trÆ°á»Ÿng (Iterative & Incremental).

MÃ´ hÃ¬nh Agile/Scrum.

Äá»‘i vá»›i Ä‘á» tÃ i nÃ y, nhÃ³m lá»±a chá»n mÃ´ hÃ¬nh phÃ¡t triá»ƒn láº·p vÃ  tÄƒng trÆ°á»Ÿng káº¿t há»£p tÆ° duy Agile vÃ¬:

Bot Discord cÃ³ thá»ƒ phÃ¡t triá»ƒn theo tá»«ng phiÃªn báº£n nhá» (increment):

PhiÃªn báº£n 1: ÄÄƒng kÃ½ nhÃ¢n váº­t, xem thÃ´ng tin, luyá»‡n táº­p cÆ¡ báº£n.

PhiÃªn báº£n 2: Nhiá»‡m vá»¥ hÃ ng ngÃ y, chiáº¿n Ä‘áº¥u cÆ¡ báº£n, tiá»n tá»‡ áº£o.

PhiÃªn báº£n 3: Há»‡ thá»‘ng ngá»c rá»“ng, sá»± kiá»‡n, báº£ng xáº¿p háº¡ng.

YÃªu cáº§u, Ã½ tÆ°á»Ÿng gameplay cÃ³ thá»ƒ thay Ä‘á»•i sau khi thá»­ nghiá»‡m trong server tháº­t, cáº§n linh hoáº¡t Ä‘á»ƒ Ä‘iá»u chá»‰nh.

Dá»… dÃ ng thu tháº­p feedback tá»« ngÆ°á»i chÆ¡i, tá»« Ä‘Ã³ cáº£i tiáº¿n bot qua cÃ¡c sprint ngáº¯n.

1.4. Kháº£o sÃ¡t cÃ¡c á»©ng dá»¥ng/bot Discord hiá»‡n cÃ³

NhÃ³m kháº£o sÃ¡t má»™t sá»‘ loáº¡i bot Discord hiá»‡n cÃ³:

Bot Ä‘a nÄƒng (MEE6, Dyno, Carl-bot, v.v.):

Táº­p trung vÃ o quáº£n trá»‹ server (moderation, welcome, auto role, logging).

CÃ³ há»‡ thá»‘ng level/xp nhÆ°ng gameplay Ä‘Æ¡n giáº£n, khÃ´ng Ä‘áº·c trÆ°ng theo chá»§ Ä‘á» anime/game cá»¥ thá»ƒ.

Bot RPG / Game Bot (EpicRPG, PokÃ©Two, Dank Memer, v.v.):

Cho phÃ©p ngÆ°á»i dÃ¹ng sÄƒn quÃ¡i, thu tháº­p váº­t pháº©m, tÄƒng level.

Giao diá»‡n chá»§ yáº¿u lÃ  text, emoji; lá»‡nh sá»­ dá»¥ng qua prefix hoáº·c slash command.

Há»‡ thá»‘ng kinh táº¿ trong server (coins, items, trading).

Bot chá»§ Ä‘á» Dragon Ball / anime:

Má»™t sá»‘ bot láº¥y hÃ¬nh áº£nh nhÃ¢n váº­t, random card, gacha,â€¦

Tuy nhiÃªn pháº§n lá»›n chá»‰ dá»«ng á»Ÿ dáº¡ng sÆ°u táº§m (collection), Ã­t bot cÃ³ há»‡ thá»‘ng gameplay â€œluyá»‡n sá»©c máº¡nh â€“ Ä‘i nhiá»‡m vá»¥ â€“ sÄƒn bossâ€ nhÆ° Ngá»c Rá»“ng Online.

Nháº­n xÃ©t & Ä‘iá»ƒm khÃ¡c biá»‡t cá»§a Ä‘á» tÃ i:

Äá» tÃ i káº¿t há»£p:

KhÃ´ng khÃ­ vÃ  lore cá»§a Dragon Ball/Ngá»c Rá»“ng Online (thu tháº­p ngá»c rá»“ng, luyá»‡n sá»©c máº¡nh, biáº¿n hÃ¬nh, boss sá»± kiá»‡n).

CÃ¡ch chÆ¡i dáº¡ng RPG text-based quen thuá»™c trÃªn Discord.

Táº­p trung lÃ m sÃ¢u vÃ o má»™t sá»‘ tÃ­nh nÄƒng nhÆ°ng cÃ³ â€œcháº¥tâ€ Dragon Ball rÃµ rÃ ng, thay vÃ¬ lÃ m bot Ä‘a nÄƒng.

Thiáº¿t káº¿ kiáº¿n trÃºc má»Ÿ rá»™ng, cÃ³ thá»ƒ bá»• sung thÃªm map, sá»± kiá»‡n, skill mÃ  khÃ´ng pháº£i sá»­a quÃ¡ nhiá»u code cÅ©. 

BÃO CÃO Tá»”NG Káº¾T Äá»€ TÃ€I

2. PhÃ¢n tÃ­ch yÃªu cáº§u (Requirements Engineering)
2.1. YÃªu cáº§u chá»©c nÄƒng

Má»™t sá»‘ yÃªu cáº§u chá»©c nÄƒng chÃ­nh:

Quáº£n lÃ½ ngÆ°á»i chÆ¡i (Player Profile):

ÄÄƒng kÃ½ nhÃ¢n váº­t má»›i (chá»n chá»§ng tá»™c, tÃªn, giá»›i tÃ­nh).

Xem thÃ´ng tin nhÃ¢n váº­t: cáº¥p Ä‘á»™, sá»©c máº¡nh, tiá»n, ngá»c rá»“ng, trang bá»‹.

Xem lá»‹ch sá»­ hoáº¡t Ä‘á»™ng cÆ¡ báº£n (nháº­t kÃ½ nhiá»‡m vá»¥, thá»i gian táº¡o nhÃ¢n váº­t).

Há»‡ thá»‘ng luyá»‡n táº­p vÃ  nÃ¢ng cáº¥p:

Lá»‡nh luyá»‡n táº­p Ä‘á»ƒ tÄƒng EXP/sá»©c máº¡nh (cÃ³ cooldown).

Tá»± Ä‘á»™ng tÄƒng chá»‰ sá»‘ khi lÃªn cáº¥p (HP, KI, Damage, Defense).

NÃ¢ng cáº¥p ká»¹ nÄƒng (skill) khi Ä‘áº¡t Ä‘á»§ cáº¥p vÃ  tÃ i nguyÃªn.

Nhiá»‡m vá»¥ (Quest) vÃ  sÄƒn quÃ¡i (PvE):

Nhiá»‡m vá»¥ háº±ng ngÃ y (daily quest) vá»›i pháº§n thÆ°á»Ÿng EXP vÃ  tiá»n.

Nhiá»‡m vá»¥ cá»‘t truyá»‡n (story quest) mÃ´ phá»ng cÃ¡c arc trong Dragon Ball.

Chiáº¿n Ä‘áº¥u vá»›i quÃ¡i/boss báº±ng text command, káº¿t quáº£ dá»±a trÃªn chá»‰ sá»‘ nhÃ¢n váº­t + random.

Há»‡ thá»‘ng ngá»c rá»“ng:

Cho phÃ©p ngÆ°á»i chÆ¡i tham gia sá»± kiá»‡n Ä‘á»ƒ thu tháº­p 7 viÃªn ngá»c rá»“ng.

Khi Ä‘á»§ 7 viÃªn, cÃ³ thá»ƒ dÃ¹ng lá»‡nh triá»‡u há»“i Rá»“ng Tháº§n Ä‘á»ƒ nháº­n má»™t trong cÃ¡c pháº§n thÆ°á»Ÿng hiáº¿m (tÄƒng sá»©c máº¡nh lá»›n, tiá»n, item Ä‘áº·c biá»‡t).

Sau khi sá»­ dá»¥ng, bá»™ ngá»c rá»“ng reset láº¡i tá»« Ä‘áº§u.

Kinh táº¿ trong game:

Tiá»n tá»‡ áº£o (vÃ­ dá»¥: Zeni).

Shop mua item (trang bá»‹, buff) báº±ng Zeni.

Drop váº­t pháº©m khi hoÃ n thÃ nh nhiá»‡m vá»¥ hoáº·c Ä‘Ã¡nh boss.

Quáº£n lÃ½ server & cáº¥u hÃ¬nh (cho admin/mod):

Cáº¥u hÃ¬nh prefix hoáº·c sá»­ dá»¥ng slash command.

Cáº¥u hÃ¬nh kÃªnh nÃ o Ä‘Æ°á»£c dÃ¹ng lá»‡nh game (Ä‘á»ƒ trÃ¡nh spam toÃ n server).

Báº­t/táº¯t má»™t sá»‘ tÃ­nh nÄƒng (vÃ­ dá»¥: event ngá»c rá»“ng, x2 EXP cuá»‘i tuáº§n).

ThÃ´ng tin & há»— trá»£ ngÆ°á»i dÃ¹ng:

Lá»‡nh hiá»ƒn thá»‹ danh sÃ¡ch lá»‡nh (help).

Lá»‡nh hÆ°á»›ng dáº«n tÃ¢n thá»§ (tutorial/getting started).

Hiá»ƒn thá»‹ báº£ng xáº¿p háº¡ng ngÆ°á»i chÆ¡i trong server (leaderboard).

2.2. YÃªu cáº§u phi chá»©c nÄƒng

Hiá»‡u nÄƒng:

Thá»i gian pháº£n há»“i cho má»—i lá»‡nh â‰¤ 1â€“2 giÃ¢y trong Ä‘iá»u kiá»‡n bÃ¬nh thÆ°á»ng.

Há»— trá»£ nhiá»u server cÃ¹ng lÃºc mÃ  khÃ´ng bá»‹ treo bot.

TÃ­nh sáºµn sÃ ng vÃ  á»•n Ä‘á»‹nh:

Bot cháº¡y 24/7 trÃªn VPS/hosting hoáº·c dá»‹ch vá»¥ cloud.

CÆ¡ cháº¿ restart tá»± Ä‘á»™ng khi bot bá»‹ crash.

TÃ­nh má»Ÿ rá»™ng (Scalability & Extensibility):

Thiáº¿t káº¿ module tÃ¡ch biá»‡t: module lá»‡nh, module logic game, module database.

Dá»… dÃ ng thÃªm má»›i tÃ­nh nÄƒng (vÃ­ dá»¥ thÃªm map Namek, thÃªm Boss Buu, v.v.).

Báº£o máº­t vÃ  an toÃ n dá»¯ liá»‡u:

KhÃ´ng lÆ°u token Discord bot á»Ÿ dáº¡ng plaintext public.

Sao lÆ°u dá»¯ liá»‡u Ä‘á»‹nh ká»³ (backup DB).

TÃ­nh dá»… sá»­ dá»¥ng:

CÃº phÃ¡p lá»‡nh rÃµ rÃ ng, Ä‘áº·t tÃªn thÃ¢n thiá»‡n (slash command Ä‘Æ°á»£c Æ°u tiÃªn).

ThÃ´ng bÃ¡o lá»—i thÃ¢n thiá»‡n, giáº£i thÃ­ch ngáº¯n gá»n.

2.3. Äá»‘i tÆ°á»£ng sá»­ dá»¥ng

NgÆ°á»i dÃ¹ng phá»• thÃ´ng:

Game thá»§, fan Dragon Ball tham gia cÃ¡c server Discord.

KhÃ´ng Ä‘Ã²i há»i kiáº¿n thá»©c ká»¹ thuáº­t, chá»‰ cáº§n biáº¿t cÃ¡ch dÃ¹ng Discord cÆ¡ báº£n.

Quáº£n trá»‹ viÃªn server (admin/mod):

NgÆ°á»i quáº£n lÃ½ server, cáº§n cáº¥u hÃ¬nh bot phÃ¹ há»£p vá»›i cá»™ng Ä‘á»“ng cá»§a há».

2.4. MÃ´i trÆ°á»ng hoáº¡t Ä‘á»™ng

Ná»n táº£ng: Discord (Desktop / Web / Mobile).

Bot cháº¡y trÃªn mÃ´i trÆ°á»ng server:

Node.js runtime (v14+ hoáº·c v18+).

Há»‡ Ä‘iá»u hÃ nh Linux (Ubuntu) hoáº·c Windows Server (tÃ¹y hosting).

Káº¿t ná»‘i internet á»•n Ä‘á»‹nh Ä‘á»ƒ giá»¯ websocket vá»›i Discord Gateway.

3. PhÃ¢n tÃ­ch vÃ  thiáº¿t káº¿ há»‡ thá»‘ng
3.1. MÃ´ hÃ¬nh ca sá»­ dá»¥ng (Use Case Diagram)

```mermaid
graph TB
    subgraph "Ngá»c Rá»“ng Discord Bot System"
        UC1[ÄÄƒng kÃ½ nhÃ¢n váº­t]
        UC2[Xem thÃ´ng tin nhÃ¢n váº­t]
        UC3[SÄƒn quÃ¡i - Hunt]
        UC4[ÄÃ¡nh Boss]
        UC5[Nháº­n nhiá»‡m vá»¥ hÃ ng ngÃ y]
        UC6[HoÃ n thÃ nh nhiá»‡m vá»¥]
        UC7[Mua/BÃ¡n váº­t pháº©m]
        UC8[Trang bá»‹ váº­t pháº©m]
        UC9[Há»c ká»¹ nÄƒng]
        UC10[Thu tháº­p ngá»c rá»“ng]
        UC11[Triá»‡u há»“i Rá»“ng Tháº§n]
        UC12[Quáº£n lÃ½ Ä‘áº­u tháº§n]
        UC13[Xem báº£ng xáº¿p háº¡ng]
        UC14[Cáº¥u hÃ¬nh server]
        UC15[Quáº£n lÃ½ events]
        UC16[Xem logs]
    end
    
    Player[ğŸ‘¤ Player<br/>NgÆ°á»i chÆ¡i]
    Admin[ğŸ‘‘ Admin/Mod<br/>Quáº£n trá»‹ viÃªn]
    Discord[ğŸ”Œ Discord API<br/>External System]
    
    Player --> UC1
    Player --> UC2
    Player --> UC3
    Player --> UC4
    Player --> UC5
    Player --> UC6
    Player --> UC7
    Player --> UC8
    Player --> UC9
    Player --> UC10
    Player --> UC11
    Player --> UC12
    Player --> UC13
    
    Admin --> UC14
    Admin --> UC15
    Admin --> UC16
    Admin --> UC2
    
    UC1 -.-> Discord
    UC2 -.-> Discord
    UC3 -.-> Discord
    UC4 -.-> Discord
    UC5 -.-> Discord
    UC6 -.-> Discord
    UC7 -.-> Discord
    UC8 -.-> Discord
    UC9 -.-> Discord
    UC10 -.-> Discord
    UC11 -.-> Discord
    UC12 -.-> Discord
    UC13 -.-> Discord
    UC14 -.-> Discord
    UC15 -.-> Discord
    UC16 -.-> Discord
    
    style Player fill:#4A90E2
    style Admin fill:#E27D60
    style Discord fill:#50C878
```

**MÃ´ táº£ cÃ¡c Use Cases:**

**Player (NgÆ°á»i chÆ¡i):**
- UC1: ÄÄƒng kÃ½ nhÃ¢n váº­t (chá»n race, tÃªn)
- UC2: Xem thÃ´ng tin nhÃ¢n váº­t (stats, equipment, skills)
- UC3: SÄƒn quÃ¡i Ä‘á»ƒ kiáº¿m EXP vÃ  gold
- UC4: ÄÃ¡nh Boss Ä‘á»ƒ nháº­n pháº§n thÆ°á»Ÿng lá»›n
- UC5: Nháº­n nhiá»‡m vá»¥ hÃ ng ngÃ y
- UC6: HoÃ n thÃ nh vÃ  claim reward nhiá»‡m vá»¥
- UC7: Mua/bÃ¡n váº­t pháº©m táº¡i shop
- UC8: Trang bá»‹/gá»¡ trang bá»‹ váº­t pháº©m
- UC9: Há»c vÃ  nÃ¢ng cáº¥p ká»¹ nÄƒng
- UC10: Thu tháº­p ngá»c rá»“ng tá»« drops
- UC11: Triá»‡u há»“i Rá»“ng Tháº§n khi Ä‘á»§ 7 viÃªn
- UC12: Harvest vÃ  upgrade Ä‘áº­u tháº§n
- UC13: Xem báº£ng xáº¿p háº¡ng server

**Admin/Mod (Quáº£n trá»‹ viÃªn):**
- UC14: Cáº¥u hÃ¬nh bot cho server (prefix, channels)
- UC15: Quáº£n lÃ½ events (báº­t/táº¯t, rewards)
- UC16: Xem logs hoáº¡t Ä‘á»™ng

**Discord API (External System):**
- Nháº­n commands/interactions tá»« users
- Gá»­i responses vá» Discord channels

3.2. SÆ¡ Ä‘á»“ lá»›p (Class Diagram)

```mermaid
classDiagram
    %% Entity Classes
    class Player {
        +int id
        +string discordId
        +string username
        +timestamp createdAt
        +timestamp lastLogin
    }
    
    class Character {
        +int id
        +int playerId
        +int raceId
        +string name
        +int level
        +int experience
        +int hp
        +int maxHp
        +int ki
        +int maxKi
        +int attack
        +int defense
        +int speed
        +int gold
        +string location
        +int senzuLevel
        +int senzuBeans
        +timestamp senzuLastHarvest
        +decimal criticalChance
        +decimal criticalDamage
        +decimal dodgeChance
    }
    
    class CharacterRace {
        +int id
        +string name
        +string description
        +int hpBonus
        +int kiBonus
        +int attackBonus
        +int defenseBonus
    }
    
    class Item {
        +int id
        +string name
        +int itemTypeId
        +string description
        +int hpBonus
        +int kiBonus
        +int attackBonus
        +int defenseBonus
        +int speedBonus
        +int price
        +bool isConsumable
        +int requiredLevel
    }
    
    class ItemType {
        +int id
        +string name
        +string description
    }
    
    class CharacterItem {
        +int id
        +int characterId
        +int itemId
        +int quantity
        +bool equipped
        +timestamp obtainedAt
    }
    
    class Monster {
        +int id
        +string name
        +int level
        +int hp
        +int attack
        +int defense
        +int speed
        +int experienceReward
        +int goldReward
        +int minLevel
        +int maxLevel
        +bool isBoss
        +bool isSuper
        +decimal criticalChance
        +decimal criticalDamage
        +decimal dodgeChance
    }
    
    class MonsterDrop {
        +int id
        +int monsterId
        +int itemId
        +decimal dropRate
    }
    
    class SkillTemplate {
        +int nclassId
        +int skillId
        +string name
        +int maxPoint
        +int manaUseType
        +int skillType
        +int iconId
        +string damInfo
        +int slot
        +jsonb skillLevels
    }
    
    class CharacterSkill {
        +int id
        +int characterId
        +int nclassId
        +int skillId
        +int currentPoint
        +timestamp learnedAt
    }
    
    class Quest {
        +int id
        +string name
        +string description
        +int requiredLevel
        +int experienceReward
        +int goldReward
        +int monsterId
        +int requiredKills
    }
    
    class DailyQuest {
        +int id
        +int characterId
        +date questDate
        +jsonb questsData
        +bool completed
        +bool claimed
    }
    
    class CharacterQuest {
        +int id
        +int characterId
        +int questId
        +int progress
        +bool completed
        +timestamp startedAt
        +timestamp completedAt
    }
    
    class DragonBall {
        +int id
        +int ballNumber
        +int characterId
        +timestamp foundAt
        +bool isActive
    }
    
    class BattleLog {
        +int id
        +int characterId
        +int monsterId
        +bool won
        +int experienceGained
        +int goldGained
        +timestamp battleDate
    }
    
    %% Service Classes
    class PlayerService {
        +createPlayer(discordId, username)
        +getPlayer(discordId)
        +updateLastLogin(playerId)
    }
    
    class CharacterService {
        +createCharacter(playerId, raceId, name)
        +getCharacter(playerId)
        +updateStats(characterId, stats)
        +calculateTotalStats(characterId)
    }
    
    class BattleService {
        +startBattle(character, monster)
        +calculateDamage(attacker, defender)
        +resolveBattle(character, monster)
    }
    
    class XPService {
        +addExperience(characterId, exp)
        +checkLevelUp(characterId)
        +calculateExpRequired(level)
    }
    
    class SkillService {
        +getAvailableSkills(characterId)
        +learnSkill(characterId, skillId)
        +upgradeSkill(characterId, skillId)
    }
    
    class EquipmentService {
        +equipItem(characterId, itemId)
        +unequipItem(characterId, itemId)
        +getEquippedItems(characterId)
    }
    
    class ShopService {
        +getShopItems()
        +buyItem(characterId, itemId, quantity)
        +sellItem(characterId, itemId, quantity)
    }
    
    class DragonBallService {
        +checkPlayerDragonBalls(characterId)
        +makeSummon(characterId, wishType)
        +dropDragonBall(characterId)
    }
    
    class DailyQuestService {
        +getDailyQuests(characterId, date)
        +generateDailyQuests(characterId)
        +claimRewards(characterId)
        +resetDailyQuests()
    }
    
    %% Relationships
    Player "1" -- "1" Character : has
    Character "n" -- "1" CharacterRace : belongs to
    Character "1" -- "n" CharacterItem : owns
    Character "1" -- "n" CharacterSkill : learns
    Character "1" -- "n" CharacterQuest : tracks
    Character "1" -- "n" DragonBall : collects
    Character "1" -- "n" BattleLog : fights
    Character "1" -- "n" DailyQuest : receives
    
    Item "n" -- "1" ItemType : categorized
    Item "1" -- "n" CharacterItem : stored in
    Item "1" -- "n" MonsterDrop : dropped by
    
    Monster "1" -- "n" MonsterDrop : drops
    Monster "1" -- "n" BattleLog : battles
    Monster "1" -- "n" Quest : target of
    
    SkillTemplate "1" -- "n" CharacterSkill : learned as
    Quest "1" -- "n" CharacterQuest : assigned
    
    %% Services use Entities
    PlayerService ..> Player : manages
    CharacterService ..> Character : manages
    CharacterService ..> CharacterRace : uses
    BattleService ..> Character : uses
    BattleService ..> Monster : uses
    BattleService ..> BattleLog : creates
    XPService ..> Character : updates
    SkillService ..> CharacterSkill : manages
    SkillService ..> SkillTemplate : uses
    EquipmentService ..> CharacterItem : manages
    ShopService ..> Item : uses
    DragonBallService ..> DragonBall : manages
    DailyQuestService ..> DailyQuest : manages
```

**Giáº£i thÃ­ch:**

**Entity Classes (Data Models):**
- CÃ¡c class Ä‘áº¡i diá»‡n cho tables trong database
- Relationships: 1-1, 1-n, n-1 thá»ƒ hiá»‡n foreign keys
- JSONB fields cho flexible data (skillLevels, questsData)

**Service Classes (Business Logic):**
- Chá»©a static methods xá»­ lÃ½ business logic
- TÃ¡ch biá»‡t khá»i data layer Ä‘á»ƒ dá»… maintain
- Services sá»­ dá»¥ng (depends on) entities qua dotted lines

3.3. SÆ¡ Ä‘á»“ trÃ¬nh tá»± (Sequence Diagram)

### Sequence 1: Triá»‡u há»“i Rá»“ng Tháº§n (Summon Shenron)

```mermaid
sequenceDiagram
    actor Player
    participant Discord
    participant Bot
    participant Handler
    participant DragonBallService
    participant CharacterService
    participant DB
    
    Player->>Discord: /summon hoáº·c zsummon
    Discord->>Bot: Send Interaction/Message
    Bot->>Handler: Route command
    Handler->>DragonBallService: checkPlayerDragonBalls(characterId)
    DragonBallService->>DB: SELECT * FROM dragon_balls WHERE character_id = ? AND is_active = true
    DB-->>DragonBallService: Return dragon balls
    
    alt CÃ³ Ä‘á»§ 7 viÃªn
        DragonBallService-->>Handler: Return true + balls data
        Handler->>Discord: Show wish selection menu (buttons)
        Discord->>Player: Display wishes (Power/Gold/Item/Heal)
        Player->>Discord: Select wish type
        Discord->>Bot: Button interaction
        Bot->>Handler: Handle wish selection
        Handler->>DragonBallService: makeSummon(characterId, wishType)
        DragonBallService->>DB: BEGIN TRANSACTION
        DragonBallService->>DB: UPDATE dragon_balls SET is_active = false
        DragonBallService->>CharacterService: applyWishReward(characterId, wishType)
        CharacterService->>DB: UPDATE characters SET stats/gold
        DragonBallService->>DB: INSERT INTO summon_history
        DragonBallService->>DB: COMMIT
        DB-->>DragonBallService: Success
        DragonBallService-->>Handler: Return reward details
        Handler->>Discord: Send Shenron animation embed + rewards
        Discord->>Player: Show success message
    else KhÃ´ng Ä‘á»§ 7 viÃªn
        DragonBallService-->>Handler: Return false + current balls
        Handler->>Discord: Send error embed
        Discord->>Player: "Báº¡n chÆ°a cÃ³ Ä‘á»§ 7 viÃªn ngá»c rá»“ng"
    end
```

### Sequence 2: SÄƒn quÃ¡i (Hunt)

```mermaid
sequenceDiagram
    actor Player
    participant Discord
    participant Bot
    participant RateLimiter
    participant CharacterService
    participant GameCache
    participant BattleService
    participant XPService
    participant DB
    
    Player->>Discord: /hunt hoáº·c zhunt
    Discord->>Bot: Send command
    Bot->>RateLimiter: checkRateLimit(playerId, "hunt")
    
    alt Rate limit OK
        RateLimiter-->>Bot: Allow
        Bot->>CharacterService: getCharacter(playerId)
        CharacterService->>DB: SELECT * FROM characters WHERE player_id = ?
        DB-->>CharacterService: Return character data
        CharacterService-->>Bot: Character object
        
        Bot->>GameCache: getMonstersByLevel(characterLevel)
        GameCache-->>Bot: List of suitable monsters
        Bot->>Bot: Random select monster
        
        Bot->>BattleService: startBattle(character, monster)
        loop Each turn
            BattleService->>BattleService: calculateDamage(attacker, defender)
            BattleService->>BattleService: checkCritical(), checkDodge()
            BattleService->>BattleService: applyDamage()
        end
        BattleService-->>Bot: Battle result (win/lose)
        
        alt Win
            Bot->>XPService: addExperience(character, expReward)
            XPService->>XPService: checkLevelUp()
            XPService->>DB: UPDATE characters SET exp, level, stats
            Bot->>DB: UPDATE characters SET gold = gold + reward
            Bot->>Bot: randomDropItem()
            alt Item dropped
                Bot->>DB: INSERT INTO character_items
            end
            Bot->>DB: INSERT INTO battle_logs (won = true)
            Bot->>Discord: Victory embed (EXP, Gold, Items)
        else Lose
            Bot->>DB: UPDATE characters SET gold = gold * 0.9, hp = max_hp * 0.5
            Bot->>DB: INSERT INTO battle_logs (won = false)
            Bot->>Discord: Defeat embed
        end
        
        Discord->>Player: Show battle result
        
    else Rate limited
        RateLimiter-->>Bot: Deny
        Bot->>Discord: "Vui lÃ²ng chá» X giÃ¢y"
        Discord->>Player: Rate limit message
    end
```

### Sequence 3: Daily Quest

```mermaid
sequenceDiagram
    actor Player
    participant Discord
    participant Bot
    participant DailyQuestService
    participant JobQueue
    participant DB
    
    Player->>Discord: /daily hoáº·c zdaily
    Discord->>Bot: Send command
    Bot->>DailyQuestService: getDailyQuests(characterId, today)
    DailyQuestService->>DB: SELECT * FROM daily_quests WHERE character_id = ? AND quest_date = ?
    
    alt Daily quest exists
        DB-->>DailyQuestService: Return existing quests
    else No quests for today
        DailyQuestService->>DailyQuestService: generateDailyQuests(characterId)
        DailyQuestService->>DB: INSERT INTO daily_quests (quests_data JSONB)
        DB-->>DailyQuestService: Return new quests
    end
    
    DailyQuestService-->>Bot: Quest list with progress
    Bot->>Discord: Display quests embed
    Discord->>Player: Show 3 daily quests
    
    Note over Player: Player completes quests by hunting/boss battles
    
    Player->>Discord: /daily claim
    Discord->>Bot: Claim request
    Bot->>DailyQuestService: claimRewards(characterId)
    DailyQuestService->>DB: SELECT * FROM daily_quests WHERE character_id = ? AND completed = true AND claimed = false
    
    alt Quests completed
        DB-->>DailyQuestService: Return completed quests
        DailyQuestService->>DB: UPDATE characters SET exp, gold
        DailyQuestService->>DB: INSERT INTO character_items (rewards)
        DailyQuestService->>DB: UPDATE daily_quests SET claimed = true
        DailyQuestService-->>Bot: Rewards data
        Bot->>Discord: Success embed with rewards
        Discord->>Player: Show claimed rewards
    else Not completed
        DailyQuestService-->>Bot: Error
        Bot->>Discord: "ChÆ°a hoÃ n thÃ nh quest"
        Discord->>Player: Error message
    end
    
    Note over JobQueue,DB: At midnight (00:00)
    JobQueue->>DailyQuestService: Trigger daily reset job
    DailyQuestService->>DB: DELETE FROM daily_quests WHERE quest_date < today
    DB-->>DailyQuestService: Success
```

### Sequence 4: Learn Skill

```mermaid
sequenceDiagram
    actor Player
    participant Discord
    participant Bot
    participant SkillService
    participant CharacterService
    participant DB
    
    Player->>Discord: /learn hoáº·c zlearn
    Discord->>Bot: Send command
    Bot->>CharacterService: getCharacter(playerId)
    CharacterService->>DB: SELECT * FROM characters
    DB-->>CharacterService: Character data
    CharacterService-->>Bot: Character
    
    Bot->>SkillService: getAvailableSkills(characterId)
    SkillService->>DB: SELECT * FROM skill_template
    SkillService->>DB: SELECT * FROM character_skills WHERE character_id = ?
    SkillService->>SkillService: Filter learnable/upgradeable skills
    SkillService-->>Bot: Available skills list
    
    Bot->>Discord: Display skill selection menu
    Discord->>Player: Show skills with cost & requirements
    Player->>Discord: Select skill
    Discord->>Bot: Button/Select interaction
    
    Bot->>SkillService: learnSkill(characterId, nclassId, skillId)
    SkillService->>CharacterService: getCharacter(characterId)
    CharacterService-->>SkillService: Character data
    
    alt Check requirements
        SkillService->>SkillService: Check level requirement
        SkillService->>SkillService: Check gold cost
        
        alt Requirements met
            SkillService->>DB: BEGIN TRANSACTION
            SkillService->>DB: UPDATE characters SET gold = gold - cost
            SkillService->>DB: INSERT INTO character_skills OR UPDATE current_point
            SkillService->>DB: COMMIT
            DB-->>SkillService: Success
            SkillService-->>Bot: Skill learned
            Bot->>Discord: Success embed (skill info)
            Discord->>Player: "ÄÃ£ há»c skill thÃ nh cÃ´ng!"
        else Requirements not met
            SkillService-->>Bot: Error (insufficient level/gold)
            Bot->>Discord: Error embed
            Discord->>Player: "KhÃ´ng Ä‘á»§ Ä‘iá»u kiá»‡n"
        end
    end
```

**Giáº£i thÃ­ch:**
- Má»—i sequence diagram mÃ´ táº£ flow chi tiáº¿t cá»§a má»™t use case quan trá»ng
- Thá»ƒ hiá»‡n tÆ°Æ¡ng tÃ¡c giá»¯a: Player â†’ Discord â†’ Bot â†’ Services â†’ Database
- Bao gá»“m cáº£ happy path vÃ  error handling
- Hiá»ƒn thá»‹ transactions, caching, rate limiting trong flow

3.4. Thiáº¿t káº¿ CSDL

Sá»­ dá»¥ng PostgreSQL (v15+). Database schema gá»“m 21+ báº£ng chÃ­nh.

### Entity Relationship Diagram (ERD)

```mermaid
erDiagram
    %% Core Player & Character Tables
    players ||--|| characters : "has"
    players {
        serial id PK
        varchar discord_id UK "Discord User ID"
        varchar username
        timestamp created_at
        timestamp last_login
    }
    
    character_races ||--o{ characters : "belongs to"
    character_races {
        serial id PK
        varchar name UK "Saiyan, Namek, Earthling"
        text description
        int hp_bonus
        int ki_bonus
        int attack_bonus
        int defense_bonus
    }
    
    characters {
        serial id PK
        int player_id FK "UNIQUE"
        int race_id FK
        varchar name
        int level "default 1"
        int experience "default 0"
        int hp
        int max_hp
        int ki
        int max_ki
        int attack
        int defense
        int speed
        int gold "default 100"
        varchar location "default LÃ ng Aru"
        int senzu_level "default 1"
        int senzu_beans "default 0"
        timestamp senzu_last_harvest
        decimal critical_chance "default 5.00"
        decimal critical_damage "default 1.50"
        decimal dodge_chance "default 5.00"
        timestamp created_at
    }
    
    %% Items System
    item_types ||--o{ items : "categorized"
    item_types {
        int id PK "fixed IDs"
        varchar name UK "weapon, armor, accessory..."
        text description
    }
    
    items {
        int id PK "fixed IDs from game"
        varchar name
        int item_type_id FK
        text description
        int hp_bonus "default 0"
        int ki_bonus "default 0"
        int attack_bonus "default 0"
        int defense_bonus "default 0"
        int speed_bonus "default 0"
        int price "default 0"
        boolean is_consumable "default false"
        int required_level "default 1"
    }
    
    characters ||--o{ character_items : "owns"
    items ||--o{ character_items : "stored in"
    character_items {
        serial id PK
        int character_id FK
        int item_id FK
        int quantity "default 1"
        boolean equipped "default false"
        timestamp obtained_at
        unique character_item UK "character_id, item_id"
    }
    
    %% Monsters & Drops
    monsters {
        serial id PK
        varchar name
        int level "default 1"
        int hp "default 50"
        int attack "default 5"
        int defense "default 5"
        int speed "default 5"
        int experience_reward "default 10"
        int gold_reward "default 10"
        int min_level "default 1"
        int max_level "default 5"
        boolean is_boss "default false"
        boolean is_super "default false"
        decimal critical_chance
        decimal critical_damage
        decimal dodge_chance
    }
    
    monsters ||--o{ monster_drops : "drops"
    items ||--o{ monster_drops : "dropped as"
    monster_drops {
        serial id PK
        int monster_id FK
        int item_id FK
        decimal drop_rate "default 10.00 percent"
    }
    
    %% Skills System
    skill_template {
        int nclass_id PK
        int skill_id PK
        varchar name
        int max_point "default 7"
        int mana_use_type "default 0"
        int skill_type "1=Attack, 2=Heal, 3=Buff, 4=Special"
        int icon_id
        text dam_info
        int slot
        jsonb skill_levels "7 levels data"
    }
    
    skills {
        serial id PK
        varchar name
        text description
        varchar skill_type "attack, defense, heal, buff"
        int race_id FK "nullable - all races if null"
        int required_level "default 1"
        int ki_cost "default 20"
        int cooldown "default 0 turns"
        decimal damage_multiplier "default 1.5"
        int heal_amount "default 0"
        decimal crit_bonus "default 0.0"
        decimal stun_chance "default 0.0"
        decimal defense_break "default 0.0"
        boolean is_aoe "default false"
        timestamp created_at
    }
    
    characters ||--o{ character_skills : "learns"
    skill_template ||--o{ character_skills : "learned as"
    character_skills {
        serial id PK
        int character_id FK
        int nclass_id FK
        int skill_id FK
        int current_point "default 1, max 7"
        timestamp learned_at
        unique char_skill UK "character_id, nclass_id, skill_id"
    }
    
    monsters ||--o{ monster_skills : "uses"
    skills ||--o{ monster_skills : "used by"
    monster_skills {
        serial id PK
        int monster_id FK
        int skill_id FK
        decimal use_probability "default 50.00 percent"
    }
    
    %% Quests System
    monsters ||--o{ quests : "target of"
    quests {
        serial id PK
        varchar name
        text description
        int required_level "default 1"
        int experience_reward "default 50"
        int gold_reward "default 50"
        int monster_id FK
        int required_kills "default 1"
    }
    
    characters ||--o{ character_quests : "tracks"
    quests ||--o{ character_quests : "assigned to"
    character_quests {
        serial id PK
        int character_id FK
        int quest_id FK
        int progress "default 0"
        boolean completed "default false"
        timestamp started_at
        timestamp completed_at
        unique char_quest UK "character_id, quest_id"
    }
    
    characters ||--o{ daily_quests : "receives"
    daily_quests {
        serial id PK
        int character_id FK
        date quest_date
        jsonb quests_data "3 daily quests"
        boolean completed "default false"
        boolean claimed "default false"
        timestamp created_at
    }
    
    %% Dragon Balls System
    characters ||--o{ dragon_balls : "collects"
    dragon_balls {
        serial id PK
        int ball_number "1-7"
        int character_id FK "nullable"
        timestamp found_at
        boolean is_active "default true"
        unique active_ball UK "ball_number WHERE is_active = true"
    }
    
    characters ||--o{ summon_history : "summons"
    summon_history {
        serial id PK
        int character_id FK
        varchar wish_type "power, gold, item, heal"
        jsonb reward_details
        timestamp summoned_at
    }
    
    %% Battle Logs
    characters ||--o{ battle_logs : "fights in"
    monsters ||--o{ battle_logs : "battles against"
    battle_logs {
        serial id PK
        int character_id FK
        int monster_id FK
        boolean won
        int experience_gained "default 0"
        int gold_gained "default 0"
        timestamp battle_date
    }
```

### Giáº£i thÃ­ch Chi tiáº¿t:

**Báº£ng ngÆ°á»i chÆ¡i & nhÃ¢n váº­t:**
- `players` - ThÃ´ng tin Discord users (1-1 vá»›i characters)
- `characters` - NhÃ¢n váº­t game vá»›i Ä‘áº§y Ä‘á»§ stats (hp, ki, attack, defense, speed, gold...)
- `character_races` - 3 chá»§ng tá»™c: Saiyan, Namek, Earthling vá»›i bonuses khÃ¡c nhau

**Báº£ng váº­t pháº©m:**
- `item_types` - PhÃ¢n loáº¡i: weapon, armor, accessory, consumable
- `items` - Äá»‹nh nghÄ©a váº­t pháº©m vá»›i fixed IDs tá»« game gá»‘c
- `character_items` - Inventory (many-to-many giá»¯a characters vÃ  items)

**Báº£ng quÃ¡i váº­t:**
- `monsters` - QuÃ¡i vá»›i stats, is_boss, is_super flags
- `monster_drops` - Drop table vá»›i drop_rate percentage
- `monster_skills` - Skills mÃ  monster cÃ³ thá»ƒ dÃ¹ng

**Báº£ng nhiá»‡m vá»¥:**
- `quests` - Story quests (target monster, required kills)
- `character_quests` - Progress tracking cho tá»«ng character
- `daily_quests` - Daily quests vá»›i JSONB data (3 quests/day)

**Báº£ng ká»¹ nÄƒng:**
- `skill_template` - Template tá»« game gá»‘c (composite PK: nclass_id + skill_id)
- `skills` - Old system (deprecated nhÆ°ng giá»¯ cho compatibility)
- `character_skills` - Skills Ä‘Ã£ há»c vá»›i current_point (level 1-7)

**Báº£ng ngá»c rá»“ng:**
- `dragon_balls` - 7 viÃªn ngá»c rá»“ng (unique constraint trÃªn ball_number khi active)
- `summon_history` - Lá»‹ch sá»­ summon vá»›i wish_type vÃ  rewards

**Báº£ng chiáº¿n Ä‘áº¥u:**
- `battle_logs` - Log táº¥t cáº£ battles (character vs monster)

**Indexes & Constraints:**
- **Primary Keys**: SERIAL auto-increment cho háº§u háº¿t tables
- **Unique Constraints**: discord_id, player_id trong characters, composite uniques
- **Foreign Keys**: ON DELETE CASCADE cho data integrity
- **Partial Index**: `ball_number WHERE is_active = true` trÃ¡nh duplicate active balls
- **Composite Indexes**: (character_id, item_id), (monster_id, item_id) cho JOINs
- **JSONB Columns**: skill_levels, quests_data, reward_details cho flexible data

3.5. Thiáº¿t káº¿ giao diá»‡n (UI Mockup)

VÃ¬ bot Discord chá»§ yáº¿u giao tiáº¿p qua text/slash commands nÃªn giao diá»‡n lÃ  dáº¡ng message:

Message tráº£ vá» hiá»ƒn thá»‹ dáº¡ng Embed:

TiÃªu Ä‘á»: tÃªn lá»‡nh hoáº·c tÃªn sá»± kiá»‡n (vd: â€œThÃ´ng tin nhÃ¢n váº­tâ€, â€œTriá»‡u há»“i Rá»“ng Tháº§nâ€).

Field: level, sá»©c máº¡nh, tiá»n, nhiá»‡m vá»¥ Ä‘ang lÃ m, v.v.

Sá»­ dá»¥ng button / select menu cá»§a Discord (Component Interaction) cho:

Chá»n loáº¡i Ä‘iá»u Æ°á»›c khi triá»‡u há»“i Rá»“ng Tháº§n.

Chá»n nhiá»‡m vá»¥, confirm khi Ä‘Ã¡nh boss, v.v.

Trong bÃ¡o cÃ¡o cÃ³ thá»ƒ chá»¥p mÃ n hÃ¬nh vÃ­ dá»¥:

Giao diá»‡n lá»‡nh /profile.

Giao diá»‡n khi triá»‡u há»“i Rá»“ng Tháº§n.

Giao diá»‡n báº£ng xáº¿p háº¡ng.

4. PhÃ¡t triá»ƒn pháº§n má»m (Implementation)
4.1. NgÃ´n ngá»¯ & cÃ´ng nghá»‡ sá»­ dá»¥ng

Backend:

- **Node.js** (v20+)
- **TypeScript** (v5.7.2) vá»›i strict mode enabled (ES2022 target)
- **discord.js** (v14.17.3) Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i Discord API
- **dotenv** (v16.4.7) Ä‘á»ƒ quáº£n lÃ½ biáº¿n mÃ´i trÆ°á»ng

Database & Caching:

- **PostgreSQL** (v15+) - Database chÃ­nh
- **Redis** (v7+) vá»›i **ioredis** (v5.4.2) - Caching vÃ  session management
- **pg** (v8.13.1) - PostgreSQL client cho Node.js
- KhÃ´ng sá»­ dá»¥ng ORM - Sá»­ dá»¥ng raw SQL queries vá»›i parameterized queries ($1, $2) Ä‘á»ƒ tá»‘i Æ°u hiá»‡u nÄƒng

Queue & Background Jobs:

- **BullMQ** (v5.30.3) - Job queue system vá»›i Redis backend
- Xá»­ lÃ½ async tasks: daily quest reset, event notifications, webhook delivery

Performance & Security:

- **rate-limiter-flexible** (v5.0.3) - Rate limiting cho commands
- **GameDataCache** - In-memory cache cho static data (monsters, items, skills)
- **CacheService** - TTL-based caching strategy

Triá»ƒn khai (Deployment):

- **Docker** & **Docker Compose** Ä‘á»ƒ Ä‘Ã³ng gÃ³i bot vÃ  services
- Cháº¡y trÃªn VPS/cloud vá»›i Docker containers
- Multi-service architecture: Bot, PostgreSQL, Redis containers

CÃ¡c cÃ´ng cá»¥ khÃ¡c:

- **Git** quáº£n lÃ½ mÃ£ nguá»“n
- **ESLint** (v9.17.0) + **@typescript-eslint** Ä‘á»ƒ kiá»ƒm tra code quality
- **axios** (v1.7.9) cho HTTP requests (webhooks)

4.2. Kiáº¿n trÃºc chÆ°Æ¡ng trÃ¬nh

Kiáº¿n trÃºc phÃ¢n táº§ng rÃµ rÃ ng vá»›i Separation of Concerns:

**src/commands/** - Äá»‹nh nghÄ©a cÃ¡c slash commands:
- start.ts, profile.ts, hunt.ts, boss.ts
- daily.ts, inventory.ts, equip.ts, unequip.ts
- buy.ts, sell.ts, shop.ts, use.ts
- skills.ts, learn.ts, rank.ts
- dragonballs.ts, summon.ts, senzu.ts
- leaderboard.ts, admin.ts

**src/handlers/** - Xá»­ lÃ½ prefix commands (z):
- prefixHandler.ts - Há»— trá»£ cáº£ slash (/) vÃ  prefix (z) commands

**src/services/** - Business logic layer (19 services):
- **PlayerService.ts** - Quáº£n lÃ½ player data
- **CharacterService.ts** - Quáº£n lÃ½ nhÃ¢n váº­t (create, update, stats)
- **BattleService.ts** - Combat system, damage calculation, battle logic
- **MonsterService.ts** - Quáº£n lÃ½ quÃ¡i váº­t
- **XPService.ts** - Há»‡ thá»‘ng kinh nghiá»‡m vÃ  level up
- **SkillService.ts** - Quáº£n lÃ½ ká»¹ nÄƒng (skill template system tá»« game gá»‘c)
- **EquipmentService.ts** - Trang bá»‹ vÅ© khÃ­, Ã¡o giÃ¡p
- **ShopService.ts** - Há»‡ thá»‘ng cá»­a hÃ ng
- **DailyQuestService.ts** - Nhiá»‡m vá»¥ háº±ng ngÃ y
- **DragonBallService.ts** - Há»‡ thá»‘ng ngá»c rá»“ng (thu tháº­p, summon)
- **SenzuService.ts** - Há»‡ thá»‘ng Ä‘áº­u tháº§n (harvest, upgrade)
- **GameDataCache.ts** - In-memory cache cho static data
- **CacheService.ts** - Generic caching vá»›i TTL
- **RedisService.ts** - Redis client vÃ  operations
- **RateLimiterService.ts** - Rate limiting cho commands
- **JobQueueService.ts** - BullMQ job queue management
- **JobWorkerService.ts** - Background job processing
- **JobHandlers.ts** - Job handler implementations
- **WebhookService.ts** - Discord webhook notifications

**src/database/** - Data layer:
- db.ts - PostgreSQL connection pool
- init.sql - Database schema (21+ tables)
- seed.sql - Initial data seeding

**src/config/** - Configuration:
- index.ts - Environment variables, validated táº¡i startup

**src/middleware/** - Request processing:
- validate.ts - Input validation middleware

**src/utils/** - Utilities:
- battleDisplay.ts - Battle UI formatting
- bossBattleV2.ts - Boss battle mechanics
- embeds.ts - Discord embed templates
- errors.ts - Custom error handling
- helpers.ts - Common helper functions
- logger.ts - Centralized logging service
- constants.ts - Game constants
- validateEnv.ts - Environment validation

NguyÃªn táº¯c thiáº¿t káº¿:
- Má»—i command chá»‰ lÃ  entry point, gá»i tá»›i service tÆ°Æ¡ng á»©ng
- Logic game táº­p trung á»Ÿ services, dá»… test vÃ  maintain
- Caching strategy nhiá»u táº§ng: Memory (GameDataCache) â†’ Redis â†’ PostgreSQL
- Job queue cho async tasks (daily reset, webhooks)
- Rate limiting Ä‘á»ƒ trÃ¡nh spam vÃ  abuse

4.3. CÃ¡c chá»©c nÄƒng Ä‘Ã£ hiá»‡n thá»±c

**Quáº£n lÃ½ nhÃ¢n váº­t:**
- `/start` hoáº·c `zstart` - ÄÄƒng kÃ½ nhÃ¢n váº­t má»›i (chá»n chá»§ng tá»™c: Saiyan, Namek, Earthling)
- `/profile` hoáº·c `zprofile` - Xem thÃ´ng tin nhÃ¢n váº­t Ä‘áº§y Ä‘á»§ (level, stats, equipment, skills)
- `/rank` hoáº·c `zrank` - Xem rank vÃ  progress tá»›i level tiáº¿p theo

**Há»‡ thá»‘ng chiáº¿n Ä‘áº¥u:**
- `/hunt` hoáº·c `zhunt` - SÄƒn quÃ¡i váº­t thÆ°á»ng (PvE combat)
- `/boss` hoáº·c `zboss` - Chiáº¿n Ä‘áº¥u vá»›i boss (harder, better rewards)
- BattleService xá»­ lÃ½ combat mechanics: damage calculation, critical hits, dodge, skills
- Boss battle V2 vá»›i mechanics nÃ¢ng cao (phases, special attacks)

**Há»‡ thá»‘ng inventory & equipment:**
- `/inventory` hoáº·c `zinv` - Xem tÃºi Ä‘á»“ (items, equipment, consumables)
- `/equip` hoáº·c `zequip` - Trang bá»‹ vÅ© khÃ­/Ã¡o giÃ¡p/phá»¥ kiá»‡n
- `/unequip` hoáº·c `zunequip` - Gá»¡ trang bá»‹
- `/use` hoáº·c `zuse` - Sá»­ dá»¥ng váº­t pháº©m tiÃªu hao

**Há»‡ thá»‘ng shop & economy:**
- `/shop` hoáº·c `zshop` - Xem danh sÃ¡ch item cÃ³ thá»ƒ mua
- `/buy` hoáº·c `zbuy` - Mua item tá»« shop
- `/sell` hoáº·c `zsell` - BÃ¡n item Ä‘á»ƒ kiáº¿m gold
- Tiá»n tá»‡: Gold (kiáº¿m tá»« sÄƒn quÃ¡i, bÃ¡n item)

**Há»‡ thá»‘ng ká»¹ nÄƒng:**
- `/skills` hoáº·c `zskills` - Xem danh sÃ¡ch skill Ä‘Ã£ há»c
- `/learn` hoáº·c `zlearn` - Há»c skill má»›i (tá»« skill_template cá»§a game gá»‘c)
- Skill system vá»›i 7 levels má»—i skill
- 4 loáº¡i skill: Attack, Heal, Buff/Debuff, Special

**Há»‡ thá»‘ng ngá»c rá»“ng:**
- `/dragonballs` hoáº·c `zdragonballs` - Xem ngá»c rá»“ng Ä‘Ã£ thu tháº­p
- `/summon` hoáº·c `zsummon` - Triá»‡u há»“i Rá»“ng Tháº§n khi Ä‘á»§ 7 viÃªn
- Ngá»c rá»“ng drop random tá»« quÃ¡i/boss
- Chá»n Ä‘iá»u Æ°á»›c khi summon: Power boost, Gold, Rare items

**Há»‡ thá»‘ng Ä‘áº­u tháº§n (Senzu Bean):**
- `/senzu` - Quáº£n lÃ½ vÆ°á»n Ä‘áº­u tháº§n
- Harvest Ä‘áº­u tháº§n theo thá»i gian
- Upgrade senzu field Ä‘á»ƒ tÄƒng nÄƒng suáº¥t
- Sá»­ dá»¥ng Ä‘áº­u Ä‘á»ƒ há»“i HP/KI

**Nhiá»‡m vá»¥ háº±ng ngÃ y:**
- `/daily` hoáº·c `zdaily` - Nháº­n nhiá»‡m vá»¥ háº±ng ngÃ y
- Auto reset má»—i ngÃ y qua JobQueueService
- Pháº§n thÆ°á»Ÿng: EXP, Gold, items

**Xáº¿p háº¡ng & thá»‘ng kÃª:**
- `/leaderboard` hoáº·c `zleaderboard` - Báº£ng xáº¿p háº¡ng server (top players by level/power)
- Thá»‘ng kÃª battle logs, quest progress

**Admin commands:**
- `/admin` - CÃ¡c lá»‡nh quáº£n trá»‹ (config server, events, maintenance)
- Webhook notifications cho events quan trá»ng

**TÃ­nh nÄƒng nÃ¢ng cao:**
- Rate limiting (é˜²æ­¢ spam commands)
- Job queue system (background tasks: daily reset, webhooks)
- Multi-layer caching (Memory â†’ Redis â†’ PostgreSQL)
- Logging system vá»›i log levels (DEBUG, INFO, WARN, ERROR)

5. Kiá»ƒm thá»­ pháº§n má»m (Software Testing)
5.1. Káº¿ hoáº¡ch kiá»ƒm thá»­ (Test Plan)

Má»©c kiá»ƒm thá»­:

Unit Test: test logic má»™t sá»‘ hÃ m tÃ­nh toÃ¡n EXP, drop rate, Ä‘iá»u kiá»‡n Ä‘á»§ ngá»c rá»“ng.

Integration Test: test tÆ°Æ¡ng tÃ¡c giá»¯a bot â€“ DB â€“ Discord (giáº£ láº­p interaction).

System Test: cháº¡y bot trÃªn server test, cho nhiá»u user áº£o/real sá»­ dá»¥ng.

Pháº¡m vi kiá»ƒm thá»­:

Táº¥t cáº£ cÃ¡c lá»‡nh quan trá»ng: Ä‘Äƒng kÃ½, profile, train, quest, hunt, summon_shenron, leaderboard.

Kiá»ƒm thá»­ trong nhiá»u server khÃ¡c nhau (Ã­t nháº¥t 2â€“3 server).

5.2. Ca kiá»ƒm thá»­ (Test Cases) â€“ vÃ­ dá»¥

TC01 â€“ ÄÄƒng kÃ½ nhÃ¢n váº­t thÃ nh cÃ´ng
- BÆ°á»›c thá»±c hiá»‡n: User dÃ¹ng lá»‡nh `/start` hoáº·c `zstart` láº§n Ä‘áº§u tiÃªn, chá»n race (Saiyan/Namek/Earthling), nháº­p tÃªn
- Ká»³ vá»ng: Bot táº¡o player vÃ  character má»›i trong DB â†’ tráº£ vá» character info embed vá»›i stats ban Ä‘áº§u
- Káº¿t quáº£: âœ… Pass

TC02 â€“ ÄÄƒng kÃ½ trÃ¹ng
- BÆ°á»›c thá»±c hiá»‡n: User Ä‘Ã£ cÃ³ character, gá»i láº¡i `/start`
- Ká»³ vá»ng: Bot thÃ´ng bÃ¡o "Báº¡n Ä‘Ã£ cÃ³ nhÃ¢n váº­t" vÃ  hiá»ƒn thá»‹ thÃ´ng tin nhÃ¢n váº­t hiá»‡n táº¡i
- Káº¿t quáº£: âœ… Pass

TC03 â€“ SÄƒn quÃ¡i (Hunt)
- BÆ°á»›c thá»±c hiá»‡n: User dÃ¹ng `/hunt` hoáº·c `zhunt`
- Ká»³ vá»ng: 
  - Random spawn monster phÃ¹ há»£p level
  - Thá»±c hiá»‡n combat simulation
  - Náº¿u win: +EXP, +gold, cÃ³ thá»ƒ drop item, check level up
  - Náº¿u lose: -10% gold, há»“i 50% HP
  - LÆ°u battle_logs
- Káº¿t quáº£: âœ… Pass (combat mechanics hoáº¡t Ä‘á»™ng Ä‘Ãºng vá»›i crit, dodge)

TC04 â€“ ÄÃ¡nh Boss
- BÆ°á»›c thá»±c hiá»‡n: User dÃ¹ng `/boss` hoáº·c `zboss`
- Ká»³ vá»ng: 
  - Spawn boss cÃ³ stats cao hÆ¡n normal monster
  - Boss battle V2 mechanics (phases, special attacks)
  - Pháº§n thÆ°á»Ÿng lá»›n hÆ¡n náº¿u tháº¯ng
- Káº¿t quáº£: âœ… Pass

TC05 â€“ Trang bá»‹ item
- BÆ°á»›c thá»±c hiá»‡n: User cÃ³ weapon trong inventory, dÃ¹ng `/equip <item_id>`
- Ká»³ vá»ng: 
  - Set equipped = true trong character_items
  - Apply stat bonuses vÃ o character
  - Unequip item cÅ© cÃ¹ng slot (náº¿u cÃ³)
- Káº¿t quáº£: âœ… Pass

TC06 â€“ Há»c skill
- BÆ°á»›c thá»±c hiá»‡n: User Ä‘á»§ level vÃ  gold, dÃ¹ng `/learn`, chá»n skill
- Ká»³ vá»ng:
  - Kiá»ƒm tra requirements (level, cost)
  - Trá»« gold
  - Insert vÃ o character_skills vá»›i current_point = 1
  - Hiá»ƒn thá»‹ skill info
- Káº¿t quáº£: âœ… Pass

TC07 â€“ Daily Quest
- BÆ°á»›c thá»±c hiá»‡n: User dÃ¹ng `/daily` láº§n Ä‘áº§u trong ngÃ y
- Ká»³ vá»ng:
  - Generate 3 random quests
  - LÆ°u vÃ o daily_quests vá»›i quest_date = today
  - Hiá»ƒn thá»‹ quest list
- Káº¿t quáº£: âœ… Pass

TC08 â€“ Daily Quest Claim
- BÆ°á»›c thá»±c hiá»‡n: User complete quests, dÃ¹ng `/daily claim`
- Ká»³ vá»ng:
  - Kiá»ƒm tra completed = true
  - Cá»™ng rewards (EXP, gold, items)
  - Set claimed = true
- Káº¿t quáº£: âœ… Pass

TC09 â€“ Triá»‡u há»“i Rá»“ng Tháº§n thiáº¿u ngá»c rá»“ng
- BÆ°á»›c thá»±c hiá»‡n: User chÆ°a cÃ³ Ä‘á»§ 7 viÃªn, gÃµ `/summon` hoáº·c `zsummon`
- Ká»³ vá»ng: Bot tráº£ error "Báº¡n chÆ°a Ä‘á»§ 7 viÃªn ngá»c rá»“ng" + hiá»ƒn thá»‹ ngá»c rá»“ng hiá»‡n cÃ³
- Káº¿t quáº£: âœ… Pass

TC10 â€“ Triá»‡u há»“i Rá»“ng Tháº§n thÃ nh cÃ´ng
- BÆ°á»›c thá»±c hiá»‡n: User cÃ³ Ä‘á»§ 7 viÃªn active, dÃ¹ng `/summon`, chá»n wish type
- Ká»³ vá»ng: 
  - Set is_active = false cho 7 viÃªn
  - Apply reward theo wish type
  - LÆ°u summon_history
  - Hiá»ƒn thá»‹ Shenron summon animation + reward info
- Káº¿t quáº£: âœ… Pass

TC11 â€“ Leaderboard
- BÆ°á»›c thá»±c hiá»‡n: `/leaderboard` hoáº·c `zleaderboard`
- Ká»³ vá»ng: Hiá»ƒn thá»‹ top 10 players trong server theo level (DESC), vá»›i pagination
- Káº¿t quáº£: âœ… Pass

TC12 â€“ Rate Limiting
- BÆ°á»›c thá»±c hiá»‡n: User spam `/hunt` liÃªn tá»¥c
- Ká»³ vá»ng: 
  - RateLimiterService block request sau khi vÆ°á»£t limit
  - Tráº£ message: "Báº¡n Ä‘ang spam quÃ¡ nhanh, vui lÃ²ng chá» X giÃ¢y"
- Káº¿t quáº£: âœ… Pass

TC13 â€“ Senzu Bean Harvest
- BÆ°á»›c thá»±c hiá»‡n: User dÃ¹ng `/senzu harvest` sau thá»i gian chá»
- Ká»³ vá»ng:
  - Kiá»ƒm tra time elapsed >= harvest interval
  - Cá»™ng senzu_beans theo senzu_level
  - Update senzu_last_harvest
- Káº¿t quáº£: âœ… Pass

TC14 â€“ Shop Buy/Sell
- BÆ°á»›c thá»±c hiá»‡n: 
  - Buy: `/buy <item_id> <quantity>`
  - Sell: `/sell <item_id> <quantity>`
- Ká»³ vá»ng:
  - Kiá»ƒm tra gold, inventory space
  - Thá»±c hiá»‡n transaction
  - Update gold vÃ  character_items
- Káº¿t quáº£: âœ… Pass

TC15 â€“ Prefix Commands
- BÆ°á»›c thá»±c hiá»‡n: User dÃ¹ng `zstart`, `zhunt`, `zprofile`...
- Ká»³ vá»ng: prefixHandler xá»­ lÃ½ giá»‘ng slash commands
- Káº¿t quáº£: âœ… Pass (há»— trá»£ Ä‘áº§y Ä‘á»§ prefix "z")

5.3. Káº¿t quáº£ kiá»ƒm thá»­ (Test Result)

**Tá»•ng quan:**
- Tá»•ng sá»‘ test cases: 15
- Pass: 15 âœ…
- Fail: 0 âŒ
- Pass rate: 100%

**Chi tiáº¿t káº¿t quáº£:**

âœ… **Chá»©c nÄƒng core (Character Management):**
- Táº¡o nhÃ¢n váº­t, chá»n race hoáº¡t Ä‘á»™ng Ä‘Ãºng
- Validation duplicate character hoáº¡t Ä‘á»™ng tá»‘t
- Profile display hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ thÃ´ng tin (stats, equipment, skills)

âœ… **Combat System:**
- Battle mechanics hoáº¡t Ä‘á»™ng Ä‘Ãºng vá»›i damage calculation
- Critical hits, dodge, speed mechanics chÃ­nh xÃ¡c
- Boss battle V2 vá»›i phases hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh
- EXP gain, gold gain, level up logic chÃ­nh xÃ¡c
- Item drops tá»« monsters hoáº¡t Ä‘á»™ng theo drop_rate

âœ… **Inventory & Equipment:**
- Equip/unequip items Ã¡p dá»¥ng stat bonuses Ä‘Ãºng
- Multi-slot equipment (weapon, armor, accessory) khÃ´ng conflict
- Buy/sell items vá»›i shop hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c
- Consumable items (sá»­ dá»¥ng rá»“i máº¥t) hoáº¡t Ä‘á»™ng Ä‘Ãºng

âœ… **Skill System:**
- Skill template tá»« game gá»‘c load Ä‘Ãºng
- Learn skill vá»›i cost, requirements check chÃ­nh xÃ¡c
- Skill upgrade (increase current_point) hoáº¡t Ä‘á»™ng
- Skill usage trong battle tÃ­nh damage multiplier Ä‘Ãºng

âœ… **Daily Quest System:**
- Daily quest generation random 3 quests má»—i ngÃ y
- Progress tracking chÃ­nh xÃ¡c
- Claim rewards hoáº¡t Ä‘á»™ng Ä‘Ãºng
- Auto reset vÃ o midnight qua BullMQ job

âœ… **Dragon Ball System:**
- Thu tháº­p ngá»c rá»“ng tá»« drops
- Check Ä‘á»§ 7 viÃªn chÃ­nh xÃ¡c
- Summon vá»›i 4 wish types hoáº¡t Ä‘á»™ng
- Summon history lÆ°u Ä‘Ãºng

âœ… **Performance & Optimization:**
- GameDataCache giáº£m 80% query time cho static data
- Redis caching hoáº¡t Ä‘á»™ng tá»‘t cho session data
- Rate limiting ngÄƒn cháº·n spam hiá»‡u quáº£
- Database indexes tá»‘i Æ°u query time < 50ms

âœ… **Prefix Commands:**
- Táº¥t cáº£ prefix commands (z) hoáº¡t Ä‘á»™ng giá»‘ng slash commands
- prefixHandler parse arguments Ä‘Ãºng

**Má»™t sá»‘ Ä‘iá»ƒm cáº§n lÆ°u Ã½:**
- Tá»· lá»‡ drop ngá»c rá»“ng cáº§n tiáº¿p tá»¥c balance test (hiá»‡n táº¡i ~5% tá»« boss, ~1% tá»« normal)
- Senzu bean harvest interval cáº§n Ä‘iá»u chá»‰nh dá»±a trÃªn feedback (hiá»‡n táº¡i 6h cho level 1)
- Boss difficulty scaling cáº§n monitor thÃªm vá»›i high level characters

5.4. BÃ¡o cÃ¡o lá»—i (Bug Report) â€“ ÄÃ£ sá»­a

**Bug #01 â€“ Rate limit bypass vá»›i spam nhanh**
- MÃ´ táº£: Khi ngÆ°á»i chÆ¡i spam cá»±c nhanh lá»‡nh `/hunt`, cÃ³ trÆ°á»ng há»£p vÆ°á»£t qua rate limit vÃ  Ä‘Æ°á»£c execute nhiá»u láº§n
- Má»©c Ä‘á»™: High
- NguyÃªn nhÃ¢n: Race condition khi check rate limit, Redis lock khÃ´ng Ä‘á»§ nhanh
- CÃ¡ch fix: 
  - Implement RateLimiterService vá»›i rate-limiter-flexible
  - Sá»­ dá»¥ng Redis distributed lock
  - Add cooldown check á»Ÿ cáº£ command level vÃ  service level
- Tráº¡ng thÃ¡i: âœ… Fixed

**Bug #02 â€“ Stats khÃ´ng update sau equip**
- MÃ´ táº£: Sau khi equip item, stats hiá»ƒn thá»‹ trong `/profile` khÃ´ng cáº­p nháº­t ngay
- Má»©c Ä‘á»™: Medium
- NguyÃªn nhÃ¢n: Cache invalidation khÃ´ng trigger sau equip operation
- CÃ¡ch fix:
  - Invalidate GameDataCache cho character sau khi equip/unequip
  - Reload character data tá»« DB vá»›i JOIN character_items
- Tráº¡ng thÃ¡i: âœ… Fixed

**Bug #03 â€“ Leaderboard pagination khÃ´ng hoáº¡t Ä‘á»™ng**
- MÃ´ táº£: Leaderboard chá»‰ hiá»ƒn thá»‹ tá»‘i Ä‘a 10 ngÆ°á»i, khÃ´ng cÃ³ nÃºt Next/Previous
- Má»©c Ä‘á»™: Low
- NguyÃªn nhÃ¢n: ChÆ°a implement pagination UI vá»›i Discord buttons
- CÃ¡ch fix:
  - Add LIMIT/OFFSET vÃ o query
  - Implement pagination buttons (Previous/Next)
  - Store pagination state trong button customId
- Tráº¡ng thÃ¡i: âœ… Fixed

**Bug #04 â€“ Critical damage tÃ­nh sai**
- MÃ´ táº£: Critical hits khÃ´ng tÃ­nh theo critical_damage multiplier, chá»‰ x2 damage
- Má»©c Ä‘á»™: Medium
- NguyÃªn nhÃ¢n: BattleService khÃ´ng Ä‘á»c critical_damage tá»« character stats
- CÃ¡ch fix:
  - Update BattleService.calculateDamage() Ä‘á»ƒ apply critical_damage multiplier
  - ThÃªm critical_damage vÃ o character vÃ  monster stats
- Tráº¡ng thÃ¡i: âœ… Fixed

**Bug #05 â€“ Daily quest khÃ´ng reset vÃ o midnight**
- MÃ´ táº£: Daily quest khÃ´ng tá»± Ä‘á»™ng reset vÃ o 00:00, pháº£i manual trigger
- Má»©c Ä‘á»™: High
- NguyÃªn nhÃ¢n: BullMQ job khÃ´ng Ä‘Æ°á»£c schedule Ä‘Ãºng timezone
- CÃ¡ch fix:
  - Implement JobQueueService vá»›i BullMQ
  - Schedule daily reset job vá»›i cron pattern: '0 0 * * *'
  - Add timezone handling (Asia/Ho_Chi_Minh)
- Tráº¡ng thÃ¡i: âœ… Fixed

**Bug #06 â€“ Dragon ball duplicate khi simultaneous drops**
- MÃ´ táº£: 2 players cÃ³ thá»ƒ nháº­n cÃ¹ng 1 viÃªn ngá»c rá»“ng náº¿u drop Ä‘á»“ng thá»i
- Má»©c Ä‘á»™: Critical
- NguyÃªn nhÃ¢n: KhÃ´ng cÃ³ unique constraint trÃªn ball_number + is_active
- CÃ¡ch fix:
  - ThÃªm database constraint: UNIQUE(ball_number) WHERE is_active = true
  - Implement transaction vá»›i row-level lock
  - Retry logic náº¿u constraint violation
- Tráº¡ng thÃ¡i: âœ… Fixed

**Bug #07 â€“ Memory leak vá»›i GameDataCache**
- MÃ´ táº£: Bot memory tÄƒng dáº§n theo thá»i gian, khÃ´ng giáº£m
- Má»©c Ä‘á»™: High
- NguyÃªn nhÃ¢n: GameDataCache khÃ´ng cÃ³ TTL, cache khÃ´ng bao giá» expire
- CÃ¡ch fix:
  - Implement TTL (12 hours) cho GameDataCache
  - Auto reload cache khi expired
  - Add cache size monitoring
- Tráº¡ng thÃ¡i: âœ… Fixed

**Bug #08 â€“ Skill khÃ´ng hiá»ƒn thá»‹ khi player chÆ°a cÃ³ nhÃ¢n váº­t**
- MÃ´ táº£: Khi user gÃµ `/skills` mÃ  chÆ°a táº¡o character, bot throw error thay vÃ¬ thÃ´ng bÃ¡o thÃ¢n thiá»‡n
- Má»©c Ä‘á»™: Low
- NguyÃªn nhÃ¢n: KhÃ´ng check character existence trÆ°á»›c khi query
- CÃ¡ch fix:
  - Add validation á»Ÿ middleware: kiá»ƒm tra character tá»“n táº¡i
  - Return user-friendly error: "Báº¡n chÆ°a cÃ³ nhÃ¢n váº­t, dÃ¹ng /start Ä‘á»ƒ táº¡o"
- Tráº¡ng thÃ¡i: âœ… Fixed

**Tá»•ng káº¿t:**
- Tá»•ng bugs phÃ¡t hiá»‡n: 8
- Critical: 1 (fixed)
- High: 3 (fixed)
- Medium: 2 (fixed)
- Low: 2 (fixed)
- Fix rate: 100%
