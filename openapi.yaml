openapi: 3.1.0
info:
  title: Ng·ªçc R·ªìng Discord Bot API
  description: |
    API documentation cho Discord bot l·∫•y √Ω t∆∞·ªüng t·ª´ Dragon Ball v√† Ng·ªçc R·ªìng Online.
    
    **Note**: Discord bot s·ª≠ d·ª•ng Discord Interactions API, kh√¥ng ph·∫£i REST API truy·ªÅn th·ªëng.
    Spec n√†y document c√°c commands v√† responses ƒë·ªÉ reference.
    
    **Authentication**: Discord OAuth2 (t·ª± ƒë·ªông qua Discord user ID)
    
    **Command Prefixes**:
    - Slash commands: `/`
    - Text commands: `z`
    
  version: 1.0.0
  contact:
    name: Developer
    email: developer@example.com
  license:
    name: MIT
    
servers:
  - url: https://discord.com/api/v10
    description: Discord API v10

tags:
  - name: Character Management
    description: Qu·∫£n l√Ω nh√¢n v·∫≠t
  - name: Combat & Hunting
    description: Chi·∫øn ƒë·∫•u v√† sƒÉn qu√°i
  - name: Inventory & Equipment
    description: Qu·∫£n l√Ω inventory v√† trang b·ªã
  - name: Shop & Economy
    description: Mua b√°n v√† kinh t·∫ø
  - name: Skills & Progression
    description: K·ªπ nƒÉng v√† ph√°t tri·ªÉn
  - name: Quests
    description: Nhi·ªám v·ª• h√†ng ng√†y
  - name: Special Features
    description: T√≠nh nƒÉng ƒë·∫∑c bi·ªát (Ng·ªçc R·ªìng, ƒê·∫≠u Th·∫ßn)
  - name: Leaderboard
    description: B·∫£ng x·∫øp h·∫°ng
  - name: Admin
    description: Qu·∫£n tr·ªã

paths:
  /commands/start:
    post:
      tags:
        - Character Management
      summary: T·∫°o nh√¢n v·∫≠t m·ªõi
      description: |
        T·∫°o nh√¢n v·∫≠t Dragon Ball m·ªõi cho user.
        
        **Aliases**: `zstart`, `zbatdau`
        
        **Flow**:
        1. Ki·ªÉm tra user ƒë√£ c√≥ character ch∆∞a
        2. Hi·ªÉn th·ªã menu ch·ªçn ch·ªßng t·ªôc (Saiyan/Namek/Earthling)
        3. User ch·ªçn race ‚Üí T·∫°o character v·ªõi stats ban ƒë·∫ßu
        
      operationId: createCharacter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                  description: Discord user ID
                  example: "123456789012345678"
                race:
                  type: string
                  enum: [Saiyan, Namek, Earthling]
                  description: Ch·ªßng t·ªôc
                  example: "Saiyan"
      responses:
        '200':
          description: Character created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterResponse'
              examples:
                saiyan:
                  summary: Saiyan character
                  value:
                    success: true
                    character:
                      id: 1
                      discord_id: "123456789012345678"
                      name: "Goku"
                      race: "Saiyan"
                      level: 1
                      hp: 150
                      max_hp: 150
                      ki: 80
                      max_ki: 80
                      attack: 35
                      defense: 30
                      speed: 25
                      gold: 100
                      location: "L√†ng Aru"
        '409':
          description: Character already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "CHARACTER_EXISTS"
                message: "B·∫°n ƒë√£ c√≥ nh√¢n v·∫≠t r·ªìi! D√πng /profile ƒë·ªÉ xem th√¥ng tin."

  /commands/profile:
    get:
      tags:
        - Character Management
      summary: Xem th√¥ng tin nh√¢n v·∫≠t
      description: |
        Hi·ªÉn th·ªã th√¥ng tin ƒë·∫ßy ƒë·ªß v·ªÅ nh√¢n v·∫≠t.
        
        **Aliases**: `zprofile`, `ztt`, `zthongtin`
        
        **Includes**:
        - Stats (HP, KI, ATK, DEF, SPD)
        - Equipment bonuses
        - Skills learned
        - Current location
        - Gold and inventory count
        
      operationId: getProfile
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
          description: Discord user ID
          example: "123456789012345678"
      responses:
        '200':
          description: Profile data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '404':
          description: Character not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "CHARACTER_NOT_FOUND"
                message: "B·∫°n ch∆∞a c√≥ nh√¢n v·∫≠t! D√πng /start ƒë·ªÉ t·∫°o nh√¢n v·∫≠t."

  /commands/hunt:
    post:
      tags:
        - Combat & Hunting
      summary: SƒÉn qu√°i v·∫≠t
      description: |
        SƒÉn qu√°i v·∫≠t ƒë·ªÉ ki·∫øm EXP, v√†ng v√† items.
        
        **Aliases**: `zhunt`, `zsan`, `zdanhquai`
        
        **Rate Limit**: 3 gi√¢y cooldown
        
        **Battle Mechanics**:
        - Turn-based combat
        - Damage formula: `baseDamage = ATK - (DEF * 0.5)`
        - Critical chance: 5% base
        - Critical multiplier: 1.5x
        - Dodge chance: 5% base
        - Skill usage: 65% chance if KI sufficient
        
        **Rewards**:
        - EXP: Based on monster level
        - Gold: Based on monster level
        - Items: Random drops based on drop rate
        - Dragon Ball: 1% chance from normal, 5% from boss
        
      operationId: hunt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                quantity:
                  type: integer
                  minimum: 1
                  maximum: 5
                  default: 1
                  description: S·ªë l∆∞·ª£ng qu√°i sƒÉn (1-5)
      responses:
        '200':
          description: Battle results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BattleResponse'
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "RATE_LIMITED"
                message: "‚è±Ô∏è Vui l√≤ng ch·ªù 3 gi√¢y tr∆∞·ªõc khi sƒÉn ti·∫øp!"
                retry_after: 3

  /commands/boss:
    post:
      tags:
        - Combat & Hunting
      summary: ƒê√°nh boss
      description: |
        Chi·∫øn ƒë·∫•u v·ªõi boss ƒë·ªÉ nh·∫≠n ph·∫ßn th∆∞·ªüng l·ªõn.
        
        **Aliases**: `zboss`
        
        **Rate Limit**: 10 gi√¢y cooldown
        
        **Boss Mechanics**:
        - Boss c√≥ stats cao h∆°n normal monsters
        - Multi-phase battles
        - Special attacks v√† skills
        - Ph·∫ßn th∆∞·ªüng g·∫•p 3-5 l·∫ßn normal
        - Dragon Ball drop rate: 5%
        
      operationId: bossBattle
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
      responses:
        '200':
          description: Boss battle results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BattleResponse'
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /commands/inventory:
    get:
      tags:
        - Inventory & Equipment
      summary: Xem inventory
      description: |
        Xem t√∫i ƒë·ªì v·ªõi t·∫•t c·∫£ items.
        
        **Aliases**: `zinventory`, `zinv`, `ztuido`
        
        **Categories**:
        - Weapons
        - Armor
        - Accessories
        - Consumables
        
        **Pagination**: 10 items per page
        
      operationId: getInventory
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
      responses:
        '200':
          description: Inventory data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InventoryResponse'

  /commands/equip:
    post:
      tags:
        - Inventory & Equipment
      summary: Trang b·ªã item
      description: |
        Trang b·ªã v≈© kh√≠, √°o gi√°p ho·∫∑c ph·ª• ki·ªán.
        
        **Aliases**: `zequip`, `ztrangbi`
        
        **Equipment Slots**:
        - Weapon (1 slot)
        - Armor (1 slot)
        - Accessory (2 slots)
        
      operationId: equipItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                item_id:
                  type: integer
      responses:
        '200':
          description: Item equipped
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  item:
                    $ref: '#/components/schemas/Item'
                  stats_change:
                    type: object
                    properties:
                      hp:
                        type: integer
                      attack:
                        type: integer
                      defense:
                        type: integer
        '400':
          description: Cannot equip
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /commands/shop:
    get:
      tags:
        - Shop & Economy
      summary: Xem shop
      description: |
        Xem danh s√°ch items c√≥ th·ªÉ mua.
        
        **Aliases**: `zshop`
        
        **Categories**:
        - Weapons
        - Armor
        - Accessories
        - Consumables
        
        **Filters**:
        - By level requirement
        - By race requirement
        - By price range
        
      operationId: getShop
      parameters:
        - name: category
          in: query
          schema:
            type: string
            enum: [all, weapon, armor, accessory, consumable]
            default: all
        - name: page
          in: query
          schema:
            type: integer
            default: 1
      responses:
        '200':
          description: Shop items
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShopResponse'

  /commands/buy:
    post:
      tags:
        - Shop & Economy
      summary: Mua item
      description: |
        Mua item t·ª´ shop.
        
        **Aliases**: `zbuy`
        
        **Validations**:
        - ƒê·ªß gold
        - ƒê·ªß level requirement
        - ƒê√∫ng race requirement (n·∫øu c√≥)
        - Inventory ch∆∞a ƒë·∫ßy (max 100 unique items)
        
      operationId: buyItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - item_id
              properties:
                user_id:
                  type: string
                item_id:
                  type: integer
                quantity:
                  type: integer
                  default: 1
                  minimum: 1
                  maximum: 99
      responses:
        '200':
          description: Purchase successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  item:
                    $ref: '#/components/schemas/Item'
                  quantity:
                    type: integer
                  total_cost:
                    type: integer
                  remaining_gold:
                    type: integer
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                insufficient_gold:
                  value:
                    error: "INSUFFICIENT_GOLD"
                    message: "B·∫°n kh√¥ng ƒë·ªß v√†ng! C·∫ßn 1000üí∞, hi·ªán c√≥ 500üí∞"
                level_requirement:
                  value:
                    error: "LEVEL_REQUIREMENT_NOT_MET"
                    message: "C·∫ßn level 10 ƒë·ªÉ mua item n√†y!"

  /commands/skills:
    get:
      tags:
        - Skills & Progression
      summary: Xem skills ƒë√£ h·ªçc
      description: |
        Xem danh s√°ch k·ªπ nƒÉng ƒë√£ h·ªçc.
        
        **Aliases**: `zskills`, `zkynang`
        
        **Skill Info**:
        - Name v√† description
        - Current point (level 1-7)
        - Damage/heal amount
        - KI cost
        - Cooldown
        
      operationId: getSkills
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Skills list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillsResponse'

  /commands/learn:
    post:
      tags:
        - Skills & Progression
      summary: H·ªçc skill m·ªõi
      description: |
        H·ªçc ho·∫∑c n√¢ng c·∫•p k·ªπ nƒÉng.
        
        **Aliases**: `zlearn`, `zhoc`
        
        **Requirements**:
        - ƒê·ªß level
        - ƒê·ªß gold
        - Skill ch∆∞a max point (7)
        
        **Skill Types**:
        1. Attack skills (damage multiplier)
        2. Heal skills (HP recovery)
        3. Buff skills (stat boost)
        4. Special skills (unique effects)
        
      operationId: learnSkill
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                skill_id:
                  type: integer
                nclass_id:
                  type: integer
      responses:
        '200':
          description: Skill learned
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  skill:
                    $ref: '#/components/schemas/Skill'
                  cost:
                    type: integer
                  remaining_gold:
                    type: integer

  /commands/daily:
    get:
      tags:
        - Quests
      summary: Xem nhi·ªám v·ª• h√†ng ng√†y
      description: |
        Xem ho·∫∑c claim nhi·ªám v·ª• h√†ng ng√†y.
        
        **Aliases**: `zdaily`
        
        **Quest Types**:
        - Hunt X monsters
        - Defeat X bosses
        - Earn X gold
        - Reach level X
        
        **Rewards**:
        - EXP
        - Gold
        - Items
        
        **Reset**: M·ªói ng√†y l√∫c 00:00 (UTC+7)
        
      operationId: getDailyQuests
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
        - name: action
          in: query
          schema:
            type: string
            enum: [view, claim]
            default: view
      responses:
        '200':
          description: Daily quests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DailyQuestResponse'

  /commands/dragonballs:
    get:
      tags:
        - Special Features
      summary: Xem ng·ªçc r·ªìng ƒë√£ thu th·∫≠p
      description: |
        Xem progress thu th·∫≠p 7 vi√™n ng·ªçc r·ªìng.
        
        **Aliases**: `zdragonballs`, `zdb`, `zngocrong`
        
        **Drop Rates**:
        - Normal monster: 1%
        - Boss: 5%
        
        **Collection**: C·∫ßn 7/7 vi√™n ƒë·ªÉ summon
        
      operationId: getDragonBalls
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Dragon balls collection
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    example: 5
                  balls:
                    type: array
                    items:
                      type: integer
                    example: [1, 2, 4, 6, 7]
                  missing:
                    type: array
                    items:
                      type: integer
                    example: [3, 5]
                  can_summon:
                    type: boolean

  /commands/summon:
    post:
      tags:
        - Special Features
      summary: Tri·ªáu h·ªìi R·ªìng Th·∫ßn
      description: |
        Tri·ªáu h·ªìi Shenron khi c√≥ ƒë·ªß 7 vi√™n ng·ªçc r·ªìng.
        
        **Aliases**: `zsummon`, `ztrieuhoi`
        
        **Wish Types**:
        1. **Power**: +20% all stats
        2. **Gold**: +50,000 gold
        3. **Rare Item**: Random legendary item
        4. **Full Heal**: HP + KI full, remove debuffs
        
        **Cooldown**: 7 ng√†y sau khi summon
        
      operationId: summonDragon
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                wish_type:
                  type: string
                  enum: [power, gold, item, heal]
      responses:
        '200':
          description: Summon successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  wish:
                    type: string
                  rewards:
                    type: object
        '400':
          description: Cannot summon
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "INSUFFICIENT_DRAGON_BALLS"
                message: "B·∫°n ch∆∞a c√≥ ƒë·ªß 7 vi√™n ng·ªçc r·ªìng! Hi·ªán c√≥: 5/7"

  /commands/senzu:
    get:
      tags:
        - Special Features
      summary: Qu·∫£n l√Ω ƒë·∫≠u th·∫ßn
      description: |
        Harvest v√† upgrade v∆∞·ªùn ƒë·∫≠u th·∫ßn.
        
        **Aliases**: `zsenzu`, `zdau`
        
        **Actions**:
        - `view`: Xem tr·∫°ng th√°i v∆∞·ªùn
        - `harvest`: Thu ho·∫°ch ƒë·∫≠u
        - `upgrade`: N√¢ng c·∫•p v∆∞·ªùn
        
        **Mechanics**:
        - Harvest interval: Gi·∫£m theo level (6h ‚Üí 1h)
        - Amount per harvest: TƒÉng theo level (3 ‚Üí 10)
        - Upgrade cost: TƒÉng theo level
        
      operationId: manageSenzu
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
        - name: action
          in: query
          schema:
            type: string
            enum: [view, harvest, upgrade]
            default: view
      responses:
        '200':
          description: Senzu field status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SenzuResponse'

  /commands/leaderboard:
    get:
      tags:
        - Leaderboard
      summary: B·∫£ng x·∫øp h·∫°ng
      description: |
        Xem b·∫£ng x·∫øp h·∫°ng server.
        
        **Aliases**: `zleaderboard`, `zrank`, `ztop`
        
        **Sort Options**:
        - Level (m·∫∑c ƒë·ªãnh)
        - Power (total stats)
        - Gold
        
        **Pagination**: 10 players per page
        
      operationId: getLeaderboard
      parameters:
        - name: guild_id
          in: query
          required: true
          schema:
            type: string
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [level, power, gold]
            default: level
        - name: page
          in: query
          schema:
            type: integer
            default: 1
      responses:
        '200':
          description: Leaderboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeaderboardResponse'

components:
  schemas:
    CharacterResponse:
      type: object
      properties:
        success:
          type: boolean
        character:
          $ref: '#/components/schemas/Character'
    
    Character:
      type: object
      properties:
        id:
          type: integer
        discord_id:
          type: string
        name:
          type: string
        race:
          type: string
          enum: [Saiyan, Namek, Earthling]
        level:
          type: integer
        experience:
          type: integer
        hp:
          type: integer
        max_hp:
          type: integer
        ki:
          type: integer
        max_ki:
          type: integer
        attack:
          type: integer
        defense:
          type: integer
        speed:
          type: integer
        gold:
          type: integer
        location:
          type: string
        critical_chance:
          type: number
          format: float
        critical_damage:
          type: number
          format: float
        dodge_chance:
          type: number
          format: float
        created_at:
          type: string
          format: date-time
    
    ProfileResponse:
      type: object
      properties:
        character:
          $ref: '#/components/schemas/Character'
        equipped_items:
          type: array
          items:
            $ref: '#/components/schemas/Item'
        skills:
          type: array
          items:
            $ref: '#/components/schemas/Skill'
        total_stats:
          type: object
          properties:
            hp:
              type: integer
            ki:
              type: integer
            attack:
              type: integer
            defense:
              type: integer
            speed:
              type: integer
    
    BattleResponse:
      type: object
      properties:
        won:
          type: boolean
        rounds:
          type: array
          items:
            $ref: '#/components/schemas/BattleRound'
        monsters_defeated:
          type: integer
        exp_gained:
          type: integer
        gold_gained:
          type: integer
        items_dropped:
          type: array
          items:
            $ref: '#/components/schemas/Item'
        leveled_up:
          type: boolean
        new_level:
          type: integer
          nullable: true
        quest_rewards:
          type: array
          items:
            type: object
    
    BattleRound:
      type: object
      properties:
        round_number:
          type: integer
        character_action:
          type: string
        character_damage:
          type: integer
        monster_action:
          type: string
        monster_damage:
          type: integer
        character_hp:
          type: integer
        monster_hp:
          type: integer
        is_critical:
          type: boolean
        is_dodge:
          type: boolean
    
    Item:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        item_type:
          type: string
          enum: [weapon, armor, accessory, consumable]
        description:
          type: string
        hp_bonus:
          type: integer
        ki_bonus:
          type: integer
        attack_bonus:
          type: integer
        defense_bonus:
          type: integer
        speed_bonus:
          type: integer
        price:
          type: integer
        required_level:
          type: integer
        is_consumable:
          type: boolean
    
    Skill:
      type: object
      properties:
        nclass_id:
          type: integer
        skill_id:
          type: integer
        name:
          type: string
        description:
          type: string
        current_point:
          type: integer
          minimum: 1
          maximum: 7
        max_point:
          type: integer
        ki_cost:
          type: integer
        damage_multiplier:
          type: number
          format: float
        skill_type:
          type: integer
          description: "1=Attack, 2=Heal, 3=Buff, 4=Special"
    
    InventoryResponse:
      type: object
      properties:
        items:
          type: array
          items:
            allOf:
              - $ref: '#/components/schemas/Item'
              - type: object
                properties:
                  quantity:
                    type: integer
                  equipped:
                    type: boolean
        total_items:
          type: integer
        total_pages:
          type: integer
        current_page:
          type: integer
    
    ShopResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Item'
        total_items:
          type: integer
        total_pages:
          type: integer
    
    SkillsResponse:
      type: object
      properties:
        skills:
          type: array
          items:
            $ref: '#/components/schemas/Skill'
        total_skills:
          type: integer
    
    DailyQuestResponse:
      type: object
      properties:
        quests:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              type:
                type: string
              description:
                type: string
              progress:
                type: integer
              required:
                type: integer
              completed:
                type: boolean
              rewards:
                type: object
                properties:
                  exp:
                    type: integer
                  gold:
                    type: integer
                  items:
                    type: array
                    items:
                      type: integer
        all_completed:
          type: boolean
        claimed:
          type: boolean
    
    SenzuResponse:
      type: object
      properties:
        level:
          type: integer
        current_beans:
          type: integer
        harvest_interval:
          type: integer
          description: Seconds between harvests
        beans_per_harvest:
          type: integer
        last_harvest:
          type: string
          format: date-time
        next_harvest:
          type: string
          format: date-time
        can_harvest:
          type: boolean
        upgrade_cost:
          type: integer
          nullable: true
    
    LeaderboardResponse:
      type: object
      properties:
        players:
          type: array
          items:
            type: object
            properties:
              rank:
                type: integer
              discord_id:
                type: string
              username:
                type: string
              level:
                type: integer
              power:
                type: integer
              gold:
                type: integer
        total_players:
          type: integer
        current_page:
          type: integer
        total_pages:
          type: integer
    
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error code
        message:
          type: string
          description: User-friendly error message (Vietnamese)
        retry_after:
          type: integer
          nullable: true
          description: Seconds to wait before retry (for rate limits)

  securitySchemes:
    DiscordOAuth:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://discord.com/api/oauth2/authorize
          tokenUrl: https://discord.com/api/oauth2/token
          scopes:
            identify: Identify user
            guilds: Access user's guilds

security:
  - DiscordOAuth: [identify, guilds]
